<!DOCTYPE html>
<html lang="en">
<head>
    <title>Shower Presentation Engine</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="node_modules/@shower/ribbon/styles/styles.css">
    <style>
        .shower {
            --slide-ratio: calc(16 / 9);
        }

        .textwbg h2 {
            margin: 30px 0 0;
            color: white;
            text-align: center;
            font-size: 70px;
        }

        .textwbg p {
            margin: 10px 0 0;
            text-align: center;
            color: white;
            font-style: italic;
            font-size: 20px;
        }

        .textwbg p a {
            color: white;
        }

        code {
            font-size: 18px;
        }

        .slide pre {
            margin-bottom: 0px;
        }
    </style>
</head>
<body class="shower list">

<header class="caption">
    <h1>Devnexus - jOOQ</h1>
    <p>Jason Lee, Red Hat</p>
</header>

<section class="slide textwbg" id="cover">
    <h2 style="margin: 100px">jOOQ: Data abstractions without distraction</h2>
    <p>Jason Lee</p>
    <p>Principal Software Engineer, Red Hat</p>
    <p>April 2022</p>
    <img class="place top left" src="pictures/rh200.png" style="margin: 50px">
    <figure>
        <img class="cover" src="pictures/cover.png" alt="Red Hat slide background">
        <figcaption class="copyright right white">
            <a href="https://redhat.com">© Red Hat</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <h2>Who Am I?</h2>
    <ul>
        <li>Software developer since 1997</li>
        <li>Principal Java Engineer at Red Hat
            <ul>
                <li>WildFly/EAP</li>
                <li>Undertow</li>
            </ul>
        </li>
        <li>Former president <a href="https://okcjug.org">Oklahoma City Java Users Group</a></li>
        <li><a href="https://www.packtpub.com/application-development/java-9-programming-blueprints">Book Author - Java
            9 Programming Blueprints</a>
        </li>
        <li><a href="https://jasondl.ee">Blogger - https://jasondl.ee</a></li>
    </ul>
</section>

<section class="slide">
    <h2>What is jOOQ?</h2>
    <ul>
        <li>“[O]riginally...created as a library for complete abstraction of JDBC and all database interaction”</li>
        <li>Type-safe SQL building</li>
        <li>SQL dialect abstraction</li>
        <li>Improved query execution and data retrieval API</li>
        <li>Active Records</li>
        <li>So much more...</li>
    </ul>
</section>

<section class="slide">
    <h2>What is jOOQ? (cont.)</h2>
    <ul>
        <li>Sibling libraries
            <ul>
                <li><a href="https://www.jooq.org/products/jOOX">jOOX</a> - The Power of jQuery Applied to W3C DOM</li>
                <li><a href="https://www.jooq.org/products/jOO%CE%BB">jOOλ</a> - The Missing Parts in Java 8</li>
                <li><a href="https://www.jooq.org/products/jOOR">jOOR</a> - Fluent Reflection in Java</li>
                <li><a href="https://www.jooq.org/products/jOOU">jOOU</a> - Unsigned Integers</li>
            </ul>
        </li>
    </ul>
</section>

<section class="slide">
    <h2>jOOQ Alternatives</h2>
    <p>Lots of options in the Java ecosystem:</p>
    <ul class="columns two">
        <li>JDBC</li>
        <li>Hibernate/JPA</li>
        <li>Spring JdbcTemplate/Data</li>
        <li>MyBatis</li>
        <li>Jdbi</li>
        <li>...</li>
    </ul>
    <p class="next">If any of these work for you, carry on!</p>
</section>

<section class="slide">
    <h2>Supported Databases</h2>
    <span class="next">What databases are supported?</span>
    <span class="next shout">All of them!</span>
</section>

<section class="slide">
    <h2>Supported Databases (cont)</h2>
    <ul class="next">
        <li>Open Source and Commercial licenses</li>
        <li class="next">Free
            <ul class="columns four">
                <li>PostgreSQL</li>
                <li>MySQL</li>
                <li>MariaDB</li>
                <li>Firebird</li>
                <li>Derby</li>
                <li>H2</li>
                <li>SQLite</li>
            </ul>
        </li>
        <li class="next">Commercial (three tiers: Express, Professional, and Enterprise)
            <ul class="columns four">
                <li>MS Access</li>
                <li>Oracle</li>
                <li>SQL Server</li>
                <li>Redshift</li>
                <li>Aurora</li>
                <li>CockroachDB</li>
                <li>Informix</li>
                <li>Teradata</li>
            </ul>
        </li>
    </ul>
</section>

<section class="slide textwbg" id="showme">
    <h2 class="shout shrink">Show me the code!!</h2>
    <figure>
        <img class="cover width" src="pictures/showmethemoney.jpg" alt="Show me the money!">
    </figure>
</section>

<section class="slide">
    <h2>Setting up the build - Maven</h2>
    <pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.jooq&lt;/groupId&gt;
    &lt;artifactId&gt;jooq&lt;/artifactId&gt;
    &lt;version&gt;3.16.5&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.jooq&lt;/groupId&gt;
    &lt;artifactId&gt;jooq-meta&lt;/artifactId&gt;
    &lt;version&gt;3.16.5&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</section>

<section class="slide">
    <h2>Setting up the build - Gradle</h2>
    <div class="next">You're on your own</div>
    <div class="next">Just kidding!
        <pre class="next"><code>dependencies {
    compile 'org.jooq:jooq:3.16.5'
    compile 'org.jooq:jooq-meta:3.16.5'
}</code></pre>
    </div>
</section>

<section class="slide">
    <h2>First step - DSLContext</h2>
    <ul>
        <li class="next">Primary API is the <code>DSLContext</code></li>
        <li class="next">Can use either <code>Connection</code> or a <code>DataSource</code>
            <ul class="next">
                <li>DSLContext context = DSL.using(conn, SQLDialect.MYSQL);</li>
                <li class="next">DSLContext context = DSL.using(dataSource, SQLDialect.MYSQL);</li>
            </ul>
        </li>
    </ul>
</section>

<section class="slide">
    <h2>First step - DSLContext (cont)</h2>
    <ul>
        <li>For finer-grained control, use a <code>Configuration</code> object:
            <br>
            <pre><code>Configuration configuration = new DefaultConfiguration()
    .set(conn)
    .set(SQLDialect.POSTGRES)
    .set(new Settings()
        .withRenderQuotedNames(RenderQuotedNames.NEVER)
        .withRenderNameCase(RenderNameCase.LOWER_IF_UNQUOTED)
    );
DSLContext context = DSL.using(configuration);
                </code>
            </pre>
        </li>
    </ul>
</section>

<section class="slide">
    <h2>Writing queries - non-codegen</h2>
    <p>
    <pre><code>dsl.select(
        DSL.field("actor_id"),
        DSL.field("last_name"),
        DSL.field("first_name")
)
.from(DSL.table("actor"))
        </code></pre>
    </p>
</section>

<section class="slide">
    <h2>Fetching data - non-codegen</h2>
    <p>Query:
    <pre><code>dsl.select(...)
        .from(DSL.table("actor"))
        <mark class="important">.fetch())
    .map(r -> Author.fromRecord(r))
    .collect(Collectors.toList())</mark></code></pre>
    </p>
</section>

<section class="slide">
    <h2>Fetching data - non-codegen (cont)</h2>
    <p>Fetching:
    <pre><code>public class Actor {
    public static Actor fromRecord(Record r) {
        return new Actor()
                .setId(r.getValue("actor_id", Long.class))
                .setFirstName(r.getValue("first_name", String.class))
                .setLastName(r.getValue("last_name", String.class));
    }
}</code></pre>
    </p>
</section>

<section class="slide">
    <h2>Code Generation - jOOQ Done right</h2>
    <div>You can use jOOQ just for SQL authoring. But you shouldn't. :)</div>
    <div class="next">jOOQ code generation produces lots of artifacts</div>
    <ul class="next columns three">
        <li>Tables</li>
        <li>Records</li>
        <li>Sequences</li>
        <li>POJOs</li>
        <li>DAOs</li>
        <li>Stored procedures</li>
        <li>User-defined types</li>
        <li>and many more</li>
    </ul>
</section>

<section class="slide">
    <h2>Generating code</h2>
    <div>Options:
        <ul class="next">
            <li class="next">XML (commandline and Maven)</li>
            <li class="next">Gradle</li>
        </ul>
    </div>
</section>

<section class="slide">
    <h2>Generating Code - XML</h2>
    <p class="next">I prefer Maven. Simpler command.</p>
    <pre class="next"><code style="font-size: 14px; line-height: 1.5;">&lt;plugin&gt;
  &lt;groupId&gt;org.jooq&lt;/groupId&gt;
  &lt;artifactId&gt;jooq-codegen-maven&lt;/artifactId&gt;
  &lt;version&gt;${version.jooq}&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;phase&gt;generate-sources&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;generate&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</section>

<section class="slide">
    <h2>Generating Code - XML (cont)</h2>
    <pre class="next"><code style="font-size: 12px; line-height: 1.5;">&lt;configuration&gt;
    &lt;jdbc&gt;
        &lt;url&gt;${jdbc.url}&lt;/url&gt;
        &lt;user&gt;${jdbc.user}&lt;/user&gt;
        &lt;password&gt;${jdbc.password}&lt;/password&gt;
        &lt;schema&gt;public&lt;/schema&gt;
    &lt;/jdbc&gt;
    &lt;generator&gt;
        &lt;database&gt;
            &lt;name&gt;org.jooq.meta.postgres.PostgresDatabase&lt;/name&gt;
            &lt;includes&gt;.*&lt;/includes&gt;
            &lt;inputSchema&gt;public&lt;/inputSchema&gt;
            &lt;outputSchema&gt;public&lt;/outputSchema&gt;
        &lt;/database&gt;
        &lt;target&gt;
            &lt;packageName&gt;com.steeplesoft.jooq_demo.generated&lt;/packageName&gt;
            &lt;directory&gt;${jooq.outputdir}&lt;/directory&gt;
        &lt;/target&gt;
    &lt;/generator&gt;
&lt;/configuration&gt;</code></pre>
</section>

<section class="slide">
    <h2>Generating Code - XML (cont)</h2>
    <pre class="next"><code style="font-size: 14px; line-height: 1.5;">$ mvn generate-sources
...
[INFO] Generating catalog       : DefaultCatalog.java
[INFO] ==========================================================
[INFO] Generating schemata      : Total: 1
[INFO] No schema version is applied for schema public. Regenerating.
[INFO] Generating schema        : Public.java
[INFO] ----------------------------------------------------------
[INFO] Tables fetched           : 31 (31 included, 0 excluded)
[INFO] Enums fetched            : 1 (1 included, 0 excluded)
[INFO] UDTs fetched             : 0 (0 included, 0 excluded)
[INFO] Sequences fetched        : 0 (0 included, 0 excluded)
[INFO] Generating tables
[INFO] Embeddables fetched      : 0 (0 included, 0 excluded)
[INFO] Generating table         : Actor.java [input=actor, output=actor, pk=actor_pkey]
</code></pre>
</section>

<section class="slide">
    <h2>Generating Code - XML + CLI</h2>
    <div class="next">Maven <code>configuration</code> saved in external file (e.g., jooq.xml)</div>
    <div class="next">File pre-amble:
        <pre><code style="font-size: 14px; line-height: 1.5;">    &lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
        &lt;configuration xmlns="http://www.jooq.org/xsd/jooq-codegen-3.16.5.xsd"&gt;</code></pre>
    </div>
    <div class="next">Command-line:
        <pre><code style="font-size: 14px; line-height: 1.5;">$ java -classpath jooq-3.16.5.jar:\
    jooq-meta-3.16.5.jar:jooq-codegen-3.16.5.jar:\
    reactive-streams-1.0.3.jar:r2dbc-spi-0.9.0.RELEASE.jar:\
    jakarta.xml.bind-api-3.0.0.jar:mysql-connector-java.jar:. \
    org.jooq.codegen.GenerationTool jooq.xml</code></pre>
    </div>
</section>

<section class="slide">
    <h2>Generating Code - Gradle</h2>
    <ul>
        <li class="next">Recommended to use the Gradle plugin by Etienne Studer (from Gradle Inc.).</li>
        <li class="next">Examples at
            <a href="https://github.com/etiennestuder/gradle-jooq-plugin/tree/master/example">
                https://github.com/etiennestuder/gradle-jooq-plugin/tree/master/example
            </a>
        </li>
        <li class="next">Programmatic:
            <pre class="next"><code style="font-size: 14px; line-height: 1.5;">GenerationTool.generate(new Configuration()
    .withJdbc(new Jdbc()
        .withDriver('org.h2.Driver')
        .withUrl('jdbc:h2:~/test-gradle')
        .withUser('sa')
        .withPassword(''))
    .withGenerator(new Generator()) // ...</code></pre>
        </li>
        <li class="next"><a
                href="https://www.jooq.org/doc/3.16/manual/code-generation/codegen-gradle/#alternatively-programmatic-configuration-can-be-used">Full
            example</a></li>
    </ul>
</section>

<section class="slide textwbg" id="getonwithit">
    <h2 class="shout shrink">Get on with it!!</h2>
    <figure>
        <img class="cover width" src="pictures/getonwithit.jpg" alt="Get on with it!">
    </figure>
</section>

<section class="slide">
    <h2>Writing queries - Codegen</h2>
    <p class="next">Old:
    <pre class="next"><code style="font-size: 14px; line-height: 1.5;">dsl.select(
        DSL.field("actor_id"),
        DSL.field("last_name"),
        DSL.field("first_name")
)
.from(DSL.table("actor"))</code></pre>
    </p>
    <p class="next">Code gen:
    <pre class="next"><code style="font-size: 14px; line-height: 1.5;">dsl.fetch(ACTOR)</code></pre>
    </p>
</section>

<section class="slide">
    <h2>Filtering Data</h2>
    <ul>
        <li class="next">Simple
            <pre class="next"><code style="font-size: 14px; line-height: 1.5;">dsl.select()
    .from(FILM)
    .where(FILM.TITLE.like("%THE%"))</code></pre>
        </li>
        <li class="next">SQL:
            <pre class="next"><code style="font-size: 14px; line-height: 1.5;">select
  film.film_id,
  film.title,
  ...
  film.fulltext
from film
where film.title like '%THE%'</code></pre>
        </li>
    </ul>
</section>

<section class="slide">
    <h2>Filtering Data (cont)</h2>
    <ul>
        <li>More complex
            <pre class="next"><code style="font-size: 14px; line-height: 1.5;">dsl.select()
    .from(CUSTOMER)
    .where(CUSTOMER.FIRST_NAME.eq("MARION"))
    .and(CUSTOMER.LAST_NAME.eq("SNYDER"))</code></pre>
        </li>
        <li class="next">SQL:
            <pre><code style="font-size: 14px; line-height: 1.5;">select
  customer.customer_id,
  ...
  customer.active
from customer
where (
  customer.first_name = 'MARION'
  and customer.last_name = 'SNYDER'
)</code></pre>
        </li>
    </ul>
</section>

<section class="slide">
    <h2>Filter Data (cont)</h2>
    <ul>
        <li class="next">One more:
            <pre><code style="font-size: 14px; line-height: 1.5;">dsl.select().from(CUSTOMER)
    .where(CUSTOMER.FIRST_NAME.eq("MARION")).and(CUSTOMER.LAST_NAME.eq("SNYDER"))
    .or(CUSTOMER.FIRST_NAME.eq("TERRY")).and(CUSTOMER.LAST_NAME.eq("GRISSOM"))</code></pre>
        </li>
        <li class="next">SQL:
            <pre><code style="font-size: 14px; line-height: 1.5;">select ... from customer
where (
  (
    (
      customer.first_name = 'MARION'
      and customer.last_name = 'SNYDER'
    )
    or customer.first_name = 'TERRY'
  )
  and customer.last_name = 'GRISSOM')</code></pre>
        </li>
    </ul>
</section>

<section class="slide">
    <h2>Filter Data (cont)</h2>
    <ul>
        <li>I lied. Let's fix it.:
            <pre class="next"><code style="font-size: 14px; line-height: 1.5;">dsl.select().from(CUSTOMER)
    .where(CUSTOMER.FIRST_NAME.eq("MARION")
        .and(CUSTOMER.LAST_NAME.eq("SNYDER")))
    .or(CUSTOMER.FIRST_NAME.eq("TERRY")
        .and(CUSTOMER.LAST_NAME.eq("GRISSOM")))</code></pre>
        </li>
        <li class="next">SQL:
            <pre><code style="font-size: 14px; line-height: 1.5;">where (
  (
    customer.first_name = 'MARION'
    and customer.last_name = 'SNYDER'
  ) or (
    customer.first_name = 'TERRY'
    and customer.last_name = 'GRISSOM'
  )
)</code></pre>
        </li>
    </ul>
</section>

<section class="slide">
    <h2>Joins</h2>
    <ul>
        <li>Join types supported:
            <ul>
                <li class="next">Cross - Cartesian product</li>
                <li class="next">Inner - Values in both tables</li>
                <li class="next">Outer - Value from one table, null from the other (LEFT, RIGHT, and FULL)</li>
                <li class="next">Semi - "existence of rows from one table in another table (using EXISTS or IN)"</li>
                <li class="next">Anti - "non-existence of rows from one table in another table (using NOT EXISTS or some
                    conditions NOT IN)"
                </li>
            </ul>
        </li>
    </ul>
</section>

<section class="slide">
    <h2>Joins - Cross</h2>
    <p>No <code>WHERE</code> class allowed.</p>
    <pre class="next"><code style="font-size: 14px; line-height: 1.5;">dsl.select()
    .from(STORE)
    .crossJoin(STAFF)
    .fetch();</code></pre>
</section>

<section class="slide">
    <h2>Joins - Inner</h2>
    <pre><code style="font-size: 14px; line-height: 1.5;">dsl.select()
    .from(STORE)
        .join(STAFF)
            .on(STORE.STORE_ID.eq(STAFF.STORE_ID))
    .fetch();</code></pre>
</section>

<section class="slide">
    <h2>Joins - Outer</h2>
    <ul>
        <li class="next">Left outer join:
            <pre><code style="font-size: 14px; line-height: 1.5;">dsl.select()
    .from(AUTHORS)
    .leftOuterJoin(BOOKS).on(AUTHORS.ID.eq(BOOKS.AUTHOR_ID))</code></pre>
        </li>
        <li class="next">Right outer join:
            <pre><code style="font-size: 14px; line-height: 1.5;">dsl.select()
    .from(AUTHORS)
    .rightOuterJoin(BOOKS).on(AUTHORS.ID.eq(BOOKS.AUTHOR_ID))</code></pre>
        </li>
        <li class="next">Full outer join:
            <pre><code style="font-size: 14px; line-height: 1.5;">dsl.select()
    .from(AUTHORS)
    .fullOuterJoin(BOOKS).on(AUTHORS.ID.eq(BOOKS.AUTHOR_ID))</code></pre>
        </li>
    </ul>
</section>

<section class="slide">
    <h2>Inserting Data</h2>
    <p>Multiple ways:
        <ul class="columns two">
            <li>INSERT .. VALUES</li>
            <li>INSERT .. DEFAULT VALUES</li>
            <li>INSERT .. RETURNING</li>
            <li>INSERT .. SELECT</li>
            <li>INSERT .. SET</li>
            <li>INSERT .. ON DUPLICATE KEY</li>
        </ul>
    </p>
</section>

<section class="slide">
    <h2>Inserting Data: INSERT .. VALUES</h2>
    <ul>
        <li class="next">dsl.insertInto(&lt;Table&gt;, [field1, field2, ..., fieldN])</li>
        <li class="next">Example:<pre><code style="font-size: 14px; line-height: 1.5;">dsl.insertInto(CUSTOMER,
    CUSTOMER.CUSTOMER_ID, CUSTOMER.STORE_ID, CUSTOMER.FIRST_NAME, CUSTOMER.LAST_NAME,
        CUSTOMER.ADDRESS_ID, CUSTOMER.ACTIVE)
    .values(1000, 1, "Dummy", "User", 1, 1)
    .execute();</code></pre>
        </li>
    </ul>
</section>

<section class="slide">
    <h2>Inserting Data: INSERT .. RETURNING</h2>
    <pre><code style="font-size: 14px; line-height: 1.5;">Record1&lt;Integer&gt; record = dsl.insertInto(CUSTOMER,
            CUSTOMER.STORE_ID, CUSTOMER.FIRST_NAME, CUSTOMER.LAST_NAME,
            CUSTOMER.ADDRESS_ID, CUSTOMER.ACTIVE)
    .values(1, "Dummy", "User", 1, 1)
    .returningResult(CUSTOMER.CUSTOMER_ID)
    .fetchOne();
Integer key = record.get(CUSTOMER.CUSTOMER_ID);</code></pre>
</section>

<section class="slide">
    <h2>Inserting Data: INSERT .. SET</h2>
    <pre><code style="font-size: 14px; line-height: 1.5;">Record1&lt;Integer&gt; record = dsl.insertInto(CUSTOMER)
        .set(CUSTOMER.STORE_ID, 1)
        .set(CUSTOMER.FIRST_NAME, "Dummy")
        .set(CUSTOMER.LAST_NAME, "User")
        .set(CUSTOMER.ADDRESS_ID, 1)
        .set(CUSTOMER.ACTIVE, 1)
        .returningResult(CUSTOMER.CUSTOMER_ID)
        .fetchOne();
Integer key = record.get(CUSTOMER.CUSTOMER_ID);</code></pre>
</section>

<section class="slide">
    <h2>Updating Data</h2>
    <ul>
        <li class="next">Basic:
            <pre class="next"><code style="font-size: 14px; line-height: 1.5;">int count = dsl.update(CUSTOMER)
    .set(CUSTOMER.ACTIVEBOOL, false)
    .set(CUSTOMER.ACTIVE, 0)
    .where(CUSTOMER.CUSTOMER_ID.eq(1))
    .execute();</code></pre>
        </li>
        <li class="next">
        </li>
    </ul>
</section>


<footer class="badge">
    <a href="https://github.com/shower/shower">Fork me on GitHub</a>
</footer>

<div class="progress"></div>

<script src="node_modules/@shower/core/dist/shower.js"></script>
<!-- Copyright © 2022 Yours Truly, Famous Inc. -->

</body>
</html>
